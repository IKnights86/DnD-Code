var iFileName = "Incarnate-Last_of_the_Lacers_Classes [from Alex Tanner, transcribed by IKnights86].js";
RequiredSheetVersion(13);

SourceList.LotL={
	name : "Incarnate: Last of the Lacers",
	abbreviation : "LotL",
	group : "DMs Guild",
	url : "https://www.dmsguild.com/product/191837/Incarnate-The-Last-of-the-Lacers",
	date : "2024/03/21"
};

RequiredSheetVersion("13");
ClassList["airlacer"] = {
	name : "Lacer, Air",
	regExpSearch : /^((?=.*air)(?=.*lacer)|(?=.*airlacer)).*$/i,
	source : ["LotL", 22],
	primaryAbility : "Strength or Dexterity",
	prereqs : "Strength 13 or Dexterity 13",
	die : 8,
	improvements : [0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 5, 5],
	saves : ["Str", "Dex"],

// EVERYTHING BELOW THIS LINE IS NOT UPDATED TO v13 YET!

	skills : ["\n\n" + toUni("MyClass") + ": Choose two from Acrobatics, Arcana, Athletics, Insight, Intimidation, Medicine, and Survival.", "\n\n" + toUni("MyClass") + ": Choose two from Acrobatics, Arcana, Athletics, Insight, Intimidation, Medicine, and Survival."],

/* SYNTAX CHANGE v12.998 >> old syntax for 'tools' and 'languages' are no longer supported!! */

	armor : [ //required; the 4 entries are for: ["light", "medium", "heavy", "shields"]
		[true, true, false, true], //required; the armor proficiencies if this is the first or only class
		[true, false, false, false] //required; the armor proficiencies if this class is multiclassed with (so not taken at level 1, but later)
	],

	weapons : [
		[true, false, [""]],
		[false, false, [""]]
	],

	equipment : "MyClass starting equipment:\n \u2022 Leather armor -or- scale mail;\n \u2022 A scimitar -or- a quarterstaff -or- a mace -or- a rapier;\n \u2022 A dungeoneer's pack -or- an explorer's pack.\n\nAlternatively, choose 4d4 \xD7 10 gp worth of starting equipment instead of both the class' and the background's starting equipment.",

	subclasses : ["Elemental Arts", []],
	//IMPORTANT: for any subclass you add using the AddSubClass() function, don't list them here! The AddSubClass() function makes its own entry in this array! If you have entries here that don't exist (because you didn't add any ClassSubList entry, or added it using the AddSubClass() function, then the sheet will throw strange errors)!

	attacks : [1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],

	abilitySave : 5,

	spellcastingFactor : 2,

	spellcastingKnown : {

		spells : [0, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 12, 13, 13, 14, 14, 15, 15, 16, 16],

		prepared : false,

	},

/*
	spellcastingList : { //Optional; Only needed if the class doesn't have its own spell list. This object denotes what spells the class has access to. All things in this object constrain the selection of spells that will be available. The contstraints are cumulative.

		class : "wizard", //Required; The name of the class from whose spell list the spells come from. This can be "any" if the spells are not limited by a spell list of just one class. The entry has to match the name of the class in the SpellsList

		school : ["Evoc", "Abjur"], //Optional; An array of abbreviations of spell school names (see SpellsList). These have to be in an array, even if it is just one value. Each entry has to match the name of the spell school in the SpellsList

		level : [0, 4], //Optional; The lower and upper limit of spell levels that the class has access to.

		ritual : false, //Optional; Denotes if only ritual (true) or only non-ritual (false) spells should be included in the list

		spells : ["light", "mending"], //Optional; If a "spells" array is present, all other objects will be ignored and only this list of spells will populate the list of available spells. each entry has to match the name of the spell in the SpellsList

		notspells : ["antipathy/sympathy", "tsunami"], //Optional; Any spells listed in this array will be excluded from the list
	},
*/
	features : {

		"chosen element" : {
			name : "Chosen Element",
			source : ["LotL", 23],
			minlevel : 1,
			description : "\n   " + "Being an airlacer gives me proficiency with blowguns, shanzis, and the acrobatics skill.",
			skills : ["Acrobatics"],
			weapons : [false, false, ["blowgun", "shanzi"]]
		},

		"basic airlacing" : {
			name : "Basic Lacing",
			source : ["LotL", 66],
			minlevel : 1,
			description : "\n   " + "I gain basic airlacing. (see notes)",
			toNotesPage : [{
				name : "Airlacing",
				source : ["LotL", 66],
				popupName : "Basic Airlacing",
				note : [
					"Initiation Time: 1 action",
          				"Range: 30 feet",
          				"Duration: Instantaneous\n",
          				"Anyone who is an Airlacer can initiate the following effects as an action within a 5-foot cube.\n",
          				"You create a harmless sensory effect using air, such as causing leaves to rustle or wind to slam shutters.",
          				"Until the end of your next turn, ranged weapon attacks against you are made with disadvantage.",
          				"You create a small blast of air which moves one unattended object within 30 feet that weighs no more than 5 pounds up to 10 feet in any direction.",
          				"Your movement speed is doubled until the end of your turn.",
          				"The area you can affect increases by 5 feet and the weight of objects you can move increases by 5 pounds when you reach 5th level (10-foot cube, 10 pounds), 11th level (15-foot cube, 15 pounds), and 17th level (20-foot cube, 20 pounds)."
				]
			}]
		},

		"elemental strike" : {
			name : "Elemental Strike",
			source : ["LotL", 24],
			minlevel : 1,
			description : "\n   " + "When I make an attack I can blast my opponent with an elemental strike. (see notes)",
			action : ["bonus action", "Elemental Strike"],
			weaponsAdd : ["Elemental Strike"],
			weapons : [false, false, ["Elemental"]],
			weaponOptions : {
				regExpSearch : /^(?=.*elemental)(?=.*strike).*$/i,
				name : "Elemental Strike",
				source : ["LotL", 24],
     				list : "ranged",
      				ability : 1,
      				type : "Elemental",
				range : "20/60 ft",
				damage : [1, 6, "bludgeoning"],
				description : "Finesse, No disadv. if target is prone in range or in melee",
      				abilitytodamage : true
			},
			toNotesPage : [{
				name : "Elemental Strike",
				source : ["LotL", 24],
				popupName : "Elemental Strike properties",
				note : [
					"You roll a d6 for the damage of your elemental strike. Your elemental strike deals bludgeoning damage.",
					"Your elemental strike is a ranged weapon with a normal range of 20 feet, or a long range of 60 feet. When attacking a target beyond normal range, you have disadvantage on the attack roll. You can't attack a target beyond the strike's long range.",
					"Despite being a ranged weapon, you do not have	disadvantage on attack rolls with your elemental strike when a hostile creature is within 5 feet of you, nor when attacking a creature that is prone within 20 feet of you.",
					"You can use Strength instead of Dexterity for the attack and damage rolls of your elemental strike.",
					"When you reduce a creature to 0 hit points, you can choose to avoid killing them with your elemental strike, leaving them unconscious.",
					"When you take the Attack action with a weapon with whichyou have proficiency on your turn (including your elemental strike), you can make one elemental strike as a bonus action."
				]
			}]
		},

		"ki" : {
			name : "Ki",
			source : ["LotL", 24],
			minlevel : 1,
			description : "\n   " + "I can spend ki points to fuel special actions and lacing forms (see third page)" + "\n   " + "I need to meditate for at least 30 min of a short rest for that short rest to restore ki",
			limfeaname : "Ki Points",
			usages : [1, 2, 3, 4, 5, 6, 6, 7, 8, 9, 9, 10, 11, 12, 12, 13, 14, 15, 15, 16],
			recovery : "short rest",
			"deflection" : {
				name : "Deflection",
				extraname : "Ki Feature",
				source : ["LotL", 24],
				description : " [1 ki point]" + "\n   " + "As a reaction, I can reduce damage done to me from an elemental strike, form attack, or spell attack.",
				action : ["reaction", ""],
				additional : levels.map(function (n) {
					return n < 1 ? "" : "1d10 + " + n + " + Wisdom modifier";
				})
			},
			"power blow" : {
				name : "Power Blow",
				extraname : "Ki Feature",
				source : ["LotL", 24],
				description : " [1 ki point]" + "\n   " + "When I hit an enemy with elemental strike I can force them to make a Str save or be pushed back 10 ft."
			},
			"surprising angle" : {
				name : "Surprising Angle",
				extraname : "Ki Feature",
				source : ["LotL", 24],
				description : " [1 ki point]" + "\n   " + "When I attack with an elemental strike I can hit the target from any angle, ignoring all cover except total cover."
			},
			autoSelectExtrachoices : [{
				extrachoice : "deflection"
			}, {
				extrachoice : "power blow"
			}, {
				extrachoice : "surprising angle"
			}]
		},

		"fighting style" : {
			name : "Fighting Style",
			source : ["LotL", 25],
			minlevel : 2,
			description : "\n   " + "Choose a Fighting Style using the \"Choose Feature\" button above",
			choices : ["Archery", "Defense", "Power Strikes", "Superior Range"],

			"archery" : FightingStyles.archery,

			"defense" : FightingStyles.defense,

			"power strikes" : {
				name : "Power Strikes Fighting Style",
				description : "\n   " + "Reroll 1 or 2 on damage for my Elemental Strikes.",
				calcChanges : {
					atkAdd : ["if (WeaponName.match(/elemental strike/i)) {fields.Description += ', Re-roll 1 or 2 on damage die';}; ", "Reroll 1 or 2 on damage for my Elemental Strikes."],
				}
			},

			"superior range" : {
				name : "Superior Range Fighting Style",
				description : "\n   " + "The short range on my Elemental Strikes are now 30 ft and the long range is 90 ft.",
				calcChanges : {
    					atkAdd : [
        					function (fields, v) {
            						if (/elemental strike/i.test(v.WeaponTextName)) {
                						fields.Range = fields.Range.replace(/\b(\d+)\/(\d+)\b/, '30/90');
            						};
        					},
        					"The short range on my Elemental Strikes are now 30 ft and the long range is 90 ft."
    					],
				},
			},
		},

		"lacing" : {
			name : "Lacing",
			source : ["LotL", 25],
			minlevel : 2,
			description : desc([
					"Using ki I can initiate airlacing forms that I know, applying Wisdom as my lacing ability.",
					"You can add the forms using the spell sheet."
			]),
			additional : levels.map(function (n, idx) {
				return n < 2 ? "" : [0, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 12, 13, 13, 14, 14, 15, 15, 16, 16][idx] + " forms known";
			})
		},

		"prana burst" : {
			name : "Prana Burst",
			source : ["LotL", 25],
			minlevel : 2,
			description : desc([
					"When I hit an elemental strike, I can expend 1 ki to do +1d8 damage",
					"This increases by +1d8 for each ki point added.",
					"You can only spend a maximum amount of ki depending on your level."
			]),
			additional : levels.map(function(n) {
				if (n < 2) return "";
				return (n < 5 ? 1 : n < 11 ? 2 : n < 17 ? 3 : 4) + " ki maximum";
			}),
		},

		"subclassfeature3" : {
			name : "Elemental Arts",
			source : ["LotL", 25],
			minlevel : 3,
			description : "\n   " + "Choose an Elemental Art you strive to emulate and put it in the \"Class\" field" + "\n   " + "Choose either Ten Animal Style or Eight Palms",
		},

		"matter skandha" : {
			name : "Matter Skandha",
			source : ["LotL", 25],
			minlevel : 3,
			description : " [2 ki points]" + desc([
				"As a reaction whenever I am subject to a melee weapon attack, I can take the disengage",
				"action and move up to half my movement speed, avoiding the attack."
			]),
			action : ["reaction", ""]
		},

		"push it" : {
			name : "Push It",
			source : ["LotL", 25],
			minlevel : 7,
			description : desc([
				"As a bonus action I can regain 2 ki points, up to my maximum number of ki points.",
				"After which, I must make a DC 10 Con save or gain 1 level of exhaustion.",
				"Each time I use this feature the DC increases by 5 and resets when I take a short rest."
			]),
			action : ["bonus action", ""]
		},

		"sensation skandha" : {
			name : "Sensation Skandha",
			source : ["LotL", 26],
			minlevel : 7,
			description : "\n   " + "My Dexterity saves vs. areas of effect negate damage on success and halve it on failure",
			savetxt : { text : ["Dex save vs. area effects: fail \u2015 half dmg, success \u2015 no dmg"] }
		},

		"cognition skandha" : {
			name : "Cognition Skandha",
			source : ["LotL", 26],
			minlevel : 11,
			description : desc([
				"If I can hear, I know the location of all invisible/hidden creatures within 60 feet of me.",
				"Additionally, I am acclimated to elevations up to 20,000 feet."
			]),
			vision : [["Cognition Skandha", 60]]
		},

		"volition skandha" : {
			name : "Volition Skandha",
			source : ["LotL", 26],
			minlevel : 15,
			description : desc([
				"I don't suffer fraility from old age and magic can't age me."
			])
		},

		"discernment skandha" : {
			name : "Discernment Skandha",
			source : ["LotL", 26],
			minlevel : 20,
			description : desc([
				"When an attacker I can see hits me with a ranged attack,",
				"I can use my reaction to make them reroll the attack and they must use the second roll."
			]),
			action : ["reaction", ""]
		}
	}
}


/* CHANGES SINCE V12.999:
	1. 'armor' attribute has been replaced with 'armorProfs', but is otherwise identical.
	2. 'weapons' attribute has been replaced with 'weaponProfs', but is otherwise identical.
	3. 'primaryAbility' should no longer have the class' name in it, nor a line break at the start, a bullet point, or a semicolon at the end.
	4. 'prereqs' should no longer have the class' name in it, nor a line break at the start, a bullet point, or a semicolon at the end.
*/
